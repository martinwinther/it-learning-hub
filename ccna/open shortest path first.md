# Open Shortest Path First

## Overview

Open Shortest Path First (OSPF) is a link state interior gateway protocol (IGP). OSPF uses the Shortest Path First (SPF) algorithm, also called Dijkstra's algorithm, to calculate routes. OSPFv2 is used for IPv4 networks and is the version relevant for CCNA.

## OSPF fundamentals

### Name components

- Open  
  - Open standard, not Cisco proprietary
- Shortest Path First  
  - Name of the algorithm used to compute paths
- Vendors can implement OSPF on any suitable platform

### Versions

- OSPFv2  
  - For IPv4
  - CCNA focus
- OSPFv3  
  - For IPv6 (and can also carry IPv4 in newer implementations)

Unless stated otherwise, OSPF refers to OSPFv2 in CCNA notes.

### Three main steps

1. Form neighbor relationships with other OSPF routers
2. Exchange link state information to build a topology map (LSDB)
3. Run SPF on the LSDB to calculate best paths

## Link state advertisements and database

### Link State Advertisements (LSAs)

- OSPF uses LSAs to describe links and networks
- Each router originates LSAs that describe its own links
- LSAs are flooded throughout an area
- Flooding ensures all routers in an area receive the same information

### Link State Database (LSDB)

- LSAs are stored in the LSDB
- LSDB represents the topology view of the area
- All routers within the same area should have identical LSDBs
- SPF runs on the LSDB to compute routes

### Common LSA types (CCNA)

- Type 1: Router LSA  
  - Generated by every router
  - Describes the router's links and costs

- Type 2: Network LSA  
  - Generated by the DR on a broadcast network
  - Lists routers on the shared segment

- Type 5: AS External LSA  
  - Generated by ASBRs
  - Advertises routes to external networks

## Areas and router roles

### Single area OSPF

- All routers are in the same area
- All share one LSDB
- Simple to configure and suitable for small networks
- Area 0 is recommended even in single area designs

### Multi area OSPF

- Divides larger networks into multiple areas
- Benefits:
  - Smaller LSDBs
  - SPF runs faster and uses less CPU
  - LSA flooding scope is limited to an area
  - Instability is contained within an area

### Area structure

- Area 0 is the backbone area
- All other areas must connect to area 0
- Traffic between non backbone areas always passes through area 0

### Router types

- Internal router  
  - All OSPF interfaces are in the same area

- Backbone router  
  - At least one interface in area 0

- Area Border Router (ABR)  
  - Connects one or more non backbone areas to area 0

- Autonomous System Boundary Router (ASBR)  
  - Injects routes from other routing domains into OSPF

### Route types

- Intra area routes  
  - Destination is in the same area

- Inter area routes  
  - Destination is in a different OSPF area

- External routes  
  - Destination is outside the OSPF domain, learned from an ASBR

## OSPF cost and metrics

### Cost calculation

- OSPF metric is called cost
- Path cost is the sum of the outgoing interface costs along the route
- Default formula: `cost = reference bandwidth / interface bandwidth`
- Default reference bandwidth: 100 Mbps
- Any result less than 1 is treated as cost 1

### Reference bandwidth

- With 100 Mbps reference bandwidth:
  - 10 Mbps: cost 10
  - 100 Mbps: cost 1
  - 1 Gbps and above: cost 1
- This hides differences between fast links
- Adjust with:
  - `auto-cost reference-bandwidth <mbps>` in router configuration mode
- All routers in the OSPF domain should use the same reference bandwidth

### Modifying link cost

Two common methods:

- Direct cost setting (preferred):
  - `ip ospf cost <value>` on the interface

- Bandwidth change:
  - `bandwidth <kbps>` on the interface
  - Affects features that use bandwidth, not actual interface speed

## Basic OSPF configuration

### OSPF process

- Create or enter OSPFv2 process:

  ```cisco
  router ospf 1
  ```

- Process ID is locally significant
- Multiple processes are possible but not common

### Router ID (RID)

- Unique 32 bit identifier for each router
- Determined in this order:
  1. Manually configured `router-id`
  2. Highest IP address on an up loopback interface
  3. Highest IP address on an up physical interface

- Show with:

  ```cisco
  show ip protocols
  ```

- Best practice: set RID explicitly for predictability

### Loopback interfaces

- Virtual interfaces that are always up when configured
- Often used to provide a stable RID source
- Configured as /32 addresses

Example:

```cisco
interface Loopback0
 ip address 1.1.1.1 255.255.255.255
```

### Enabling OSPF on interfaces

Method 1: network statements

- Under `router ospf`:

  ```cisco
  router ospf 1
   network 10.0.0.0 0.0.0.255 area 0
  ```

- Activates OSPF on interfaces with addresses that match the range
- Required knowledge for exams

Method 2: interface commands

- On the interface:

  ```cisco
  interface GigabitEthernet0/0
   ip ospf 1 area 0
  ```

- Explicitly enables OSPF on that interface

### Passive interfaces

- Passive interfaces advertise their networks but do not send OSPF hellos
- Common on interfaces that face end hosts
- Configured under `router ospf`:

  ```cisco
  router ospf 1
   passive-interface default
   no passive-interface GigabitEthernet0/0
  ```

- Loopback interfaces are usually passive

### Default route advertisement

- Configure a default route:

  ```cisco
  ip route 0.0.0.0 0.0.0.0 next-hop
  ```

- Advertise into OSPF:

  ```cisco
  router ospf 1
   default-information originate
  ```

- Router becomes an ASBR when it injects the default route

## OSPF neighbor relationships

### OSPF message types

Main OSPF message types:

- Hello  
  - Neighbor discovery and keepalive

- Database Description (DBD)  
  - Summary of LSDB contents

- Link State Request (LSR)  
  - Request specific LSAs

- Link State Update (LSU)  
  - Send LSAs

- Link State Acknowledgment (LSAck)  
  - Acknowledge receipt of LSUs

### Neighbor states

Key states from neighbor bring up:

- Down  
  - No hellos received

- Init  
  - Hello received, but local RID not listed

- 2-Way  
  - Each router sees its own RID in the other's hello

- ExStart and Exchange  
  - Decide master and slave, exchange DBDs

- Loading  
  - Request and receive LSAs with LSR and LSU

- Full  
  - LSDBs are synchronized, adjacency is complete

### Hello messages and timers

- Sent to multicast 224.0.0.5 (all OSPF routers)
- Maintain neighbor relationships
- Default timers on broadcast networks:
  - Hello interval 10 seconds
  - Dead interval 40 seconds
- Dead interval is usually four times the hello interval
- Hello and dead timers must match between neighbors

## OSPF network types and DR/BDR

### Network types

- OSPF network type is an interface property
- Influences timers, DR/BDR elections, and adjacency behavior

### Broadcast network type

- Default on Ethernet interfaces
- Characteristics:
  - Neighbors discovered dynamically
  - DR and BDR elected
  - Full adjacency formed with DR and BDR
  - DROther routers stay in 2-Way state with each other

### Designated Router and Backup DR

- One DR and one BDR per broadcast segment
- Reduce OSPF flooding by centralizing LSA distribution
- DROthers send some messages to multicast 224.0.0.6 (all DR routers)

### DR/BDR election

- Election rules:
  1. Highest OSPF interface priority
  2. Highest RID if priorities tie

- Priority is set per interface:

  ```cisco
  ip ospf priority <value>
  ```

- Once elected, DR and BDR remain in place until OSPF is reset on the segment

### Point-to-point network type

- Suitable for links that connect exactly two routers
- Characteristics:
  - No DR or BDR
  - Routers form a full adjacency with each other
  - Neighbors discovered dynamically
  - Hello and dead timers usually 10 and 40
- Configured with:

  ```cisco
  interface Serial0/0/0
   ip ospf network point-to-point
  ```

- Default on many serial interfaces

## Neighbor requirements

For two routers to become OSPF neighbors and reach Full state, several parameters must match:

- Area number
- Subnet and mask on the shared link
- Hello interval and dead interval
- Authentication type and key (if configured)
- Network type
- IP MTU

Requirements that must be unique:

- Router IDs must be unique within the OSPF domain

### Effects of mismatches

- Area, timers, authentication, or network type mismatches can prevent a neighbor relationship
- IP MTU mismatch can hold neighbors in ExStart or Exchange
- Network type mismatch can prevent LSDB synchronization

## Verification and troubleshooting

### Verification commands

- `show ip protocols`  
  - Process ID, RID, networks, and timers

- `show ip ospf interface brief`  
  - Interfaces running OSPF and their costs

- `show ip ospf interface`  
  - Detailed interface level OSPF information

- `show ip ospf neighbor`  
  - Neighbor table, states, and DR/BDR roles

- `show ip route ospf`  
  - Routes learned through OSPF

- `show ip ospf database`  
  - LSDB contents

### Common issues

- Neighbors not forming
  - Check area number, timers, authentication, and subnet match
- Routes missing
  - Confirm interfaces are not passive unintentionally
  - Check network statements or interface `ip ospf` configuration
- Suboptimal path selection
  - Verify reference bandwidth and interface costs
- DR/BDR behavior unexpected
  - Check priorities and RIDs
- LSDB out of sync
  - Look for MTU or network type mismatches

### Basic troubleshooting flow

1. Confirm interfaces should run OSPF and are up
2. Check neighbor table with `show ip ospf neighbor`
3. Verify matching parameters and unique RIDs
4. Confirm expected routes with `show ip route ospf`
5. Inspect LSDB with `show ip ospf database` when needed

## Quick review

- OSPF is an open standard link state IGP that uses SPF (Dijkstra) to compute paths.  
- Routers flood LSAs and build an LSDB per area, then run SPF to create the routing table.  
- Area 0 is the backbone; other areas must connect to it through ABRs.  
- Router roles include internal, backbone, ABR, and ASBR; route types include intra area, inter area, and external.  
- Cost is based on reference bandwidth and interface bandwidth; reference bandwidth should be consistent on all routers.  
- OSPF neighbors go through several states before reaching Full, using hello, DBD, LSR, LSU, and LSAck messages.  
- Network types control DR/BDR elections and adjacency behavior on each segment.  
- Neighbor formation requires matching parameters such as area, timers, authentication, MTU, and network type, with unique RIDs.  
- Core verification uses `show ip protocols`, `show ip ospf interface`, `show ip ospf neighbor`, `show ip route ospf`, and `show ip ospf database`.

